# SPA × 業務システムにおけるREST API設計の実践

SPA（Single Page Application）を業務システムに落とし込むときに、「SPAの概念」と「業務アプリ設計の現実」がズレて見えることはよくあります。
順に整理しつつ、最後に「他によくある悩み」も挙げます。

## 1. REST API の設計（URLと意味付け）

**基本的には「リソース指向」**が REST の原則。

**例：** `/users/{id}` → id で一意に識別できるユーザーを表す。

業務系だと「機能単位」で設計しがち（例：`/approveUser`, `/sendReport`）。

これは RPC的（手続き呼び出し的） 発想に近い。

### 業務系に落とし込むなら：

「対象は何か？」を明示的に URL にする

**例：** `/reports/{id}/approve` （レポートというリソースを承認する操作）

リソースが複雑に見える場合は リソース＋動詞っぽいサブリソース で表現するのが現実的。
→ 「URLから読み取れない」不安を減らせる。

> **💡 ポイント：** これは RESTのリソース設計原則（Resource Oriented Design）に沿った考え方。
> 業務システムでも「リソース指向」＋「ユースケース指向」の折衷が多いです。

## 2. 初期表示で大量フェッチ問題（ドロップダウンなど）

選択肢が 7 つもあると、個別に `GET /options/foo`, `GET /options/bar` … で取るとオーバーフェッチ。

実務では まとめてフェッチした方が良いケースが多い。

**例：** `GET /initial-data?screen=reportCreate` → 必要な選択肢を全部返す。

これは BFF (Backend for Frontend) の概念に近い。

画面単位で最適化された API を用意する。

SPA の「ネットワーク最適化」実務でよくやる。

> **💡 ポイント：** REST の純粋主義からは外れるけど、パフォーマンス最適化のために現場で採用されるパターン。

## 3. 複合キーの一覧取得とレスポンスのキー

フロントで一覧データを扱うときに 一意なキー（id）がないと diff や更新が難しい。

なのでレスポンスには必ず「一意キー」を含めるべき。

DBに複合キーしかなくても、API用に surrogate key（疑似ID）を発行するのが普通。

これは REST というよりデータ正規化やUIフレームワークの state 管理原則に沿っている。

React, Vue, Angular などが リスト描画時に一意キーを必要とするのと同じ考え方。

## 4. チェックボックスやラジオボタンの value 値の設定場所

### 原則はサーバー側（マスターデータ）

**例：** DBに「性別コード（M/F）」があり、APIで返す → フロントで value に設定。

こうすれば value が業務ロジックに沿い、フロント側で勝手に変えずに済む。

### ただし：

単なる UI 都合（true/false, yes/no）なら フロント側固定値でもよい。

### 判断基準：

- **業務ロジック依存** → サーバー側
- **純粋にUI構成** → フロント側

> **💡 ポイント：** これは 関心の分離（Separation of Concerns） の原則に沿った考え方。

## 5. 他によくある悩み（SPA × 業務システム）

### ページング or 無限スクロール

業務系はページング（例：`GET /users?page=2&size=50`）が多い。

無限スクロールは UX は良いが「再現性・帳票出力」に弱い。

### サーバー vs クライアントでのバリデーション

- **クライアント：** 即時フィードバック用
- **サーバー：** 業務ルール担保用

→ 両方実装するのが基本。

### 権限とデータフィルタリング

API レベルで「見えるデータを制御」しないと、SPA 側で隠しても無意味。

### ステート管理の分離

「一時的UIの状態（モーダル開閉）」と「API由来の業務データ」を分ける。

Jotai/Redux/ReactQuery などを整理しておく。

### 一括更新 vs 個別更新

一覧で複数チェックを入れて一括更新する場合、

- `PATCH /users` （リストをまとめて送る）か、
- `PATCH /users/{id}` を複数呼ぶか、設計を迷いやすい。

## まとめ

1. **RESTの原則に沿うが業務系はサブリソースやユースケース指向でOK**
2. **初期データは BFF や画面最適化APIでまとめ取得**
3. **一意キーは必須（UIフレームワーク都合＋正規化原則）**
4. **value は「業務依存ならサーバー側」**
5. **他にもページング・権限・バリデーション・一括更新など実務でよく出る**
