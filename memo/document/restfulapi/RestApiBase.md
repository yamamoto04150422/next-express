# REST API 概要

## 目次

- [はじめに](#はじめに)
- [基本概念](#基本概念)
  - [リソース](#リソース)
  - [HTTPメソッド](#httpメソッド)
  - [ステートレス](#ステートレス)
  - [URI](#uri)
  - [レスポンス](#レスポンス)
- [例](#例)
  - [GET /users](#get-users)
- [RestApiの概念](#restapiの概念)
  - [副作用](#副作用)
  - [安全性](#安全性)
  - [冪等性](#冪等性)
- [Restとは](#restとは)
  - [クライアント/サーバ](#クライアントサーバ)
  - [ステートレス](#ステートレス-1)
  - [キャッシュ制御](#キャッシュ制御)
  - [統一インターフェイス](#統一インターフェイス)
  - [階層化システム](#階層化システム)
  - [コードオンデマンド](#コードオンデマンド)
- [REST API 成熟モデル](#rest-api-成熟モデル)
  - [LEVEL0](#level0)
  - [LEVEL1](#level1)
  - [LEVEL2](#level2)
  - [LEVEL3](#level3)
- [URI設計](#uri設計)
  - [短く入力しやすいこと](#短く入力しやすいこと)
  - [人が読んで理解できる](#人が読んで理解できる)
  - [大文字込み児が混在しない](#大文字込み児が混在しない)
  - [単語はハイフンでつなぐ](#単語はハイフンでつなぐ)
  - [単語は複数形で](#単語は複数形で)
  - [エンコードを必要とする文字を使用しない](#エンコードを必要とする文字を使用しない)
  - [サーバー側のアーキテクチャを反映しない](#サーバー側のアーキテクチャを反映しない)
  - [ルールの統一化](#ルールの統一化)
  - [クエリパラメータ](#クエリパラメータ)
  - [パスパラメータ](#パスパラメータ)
- [大量アクセス制御](#大量アクセス制御)
  - [レートリミット](#レートリミット)
  - [レートリミットの設計時の考慮点](#レートリミットの設計時の考慮点)
- [レートリミットのアルゴリズム](#レートリミットのアルゴリズム)
  - [Fixd Window](#fixd-window)
  - [Silding log](#silding-log)
  - [Sliding window](#sliding-window)
- [API脆弱性対策](#api脆弱性対策)
  - [XSS](#xss)
  - [SCRF](#scrf)
  - [HTTP](#http)
  - [JSON WEB TOKEN](#json-web-token)
- [API](#api)
  - [OPEN APIとは](#open-apiとは)
    - [OPEN API Specification](#open-api-specification)
    - [swagger](#swagger)

## はじめに

REST API（Representational State Transfer API）は、ウェブサービスを設計するためのアーキテクチャスタイルです。RESTは、リソースの状態を表現し、それに対する操作をHTTPプロトコルを使用して行います。RESTfulなサービスは、HTTPのメソッド（GET、POST、PUT、DELETEなど）を利用して、リソースの取得、作成、更新、削除を行います。

## 基本概念

### リソース

リソースは、APIが操作する対象物です。RESTでは、すべてのリソースが一意のURI（Uniform Resource Identifier）によって識別されます。リソースは、データのエンティティや、データのコレクションを表します。

### HTTPメソッド

REST APIは以下の主要なHTTPメソッドを使用してリソースに対する操作を行います：

- **GET**: リソースの取得
- **POST**: リソースの作成
- **PUT**: リソースの更新
- **DELETE**: リソースの削除

### ステートレス

RESTはステートレスであることを原則としています。すなわち、各APIリクエストは、他のリクエストとは独立して処理され、サーバーはクライアントの状態を保持しません。

### URI

リソースはURIで識別されます。例えば、ユーザーリソースは次のようなURIで表されます：
/users
/users/{id}

ここで、`/users`はユーザーのコレクションを表し、`/users/{id}`は特定のユーザーを表します。

### レスポンス

REST APIのレスポンスは通常、JSON形式で返されます。レスポンスには、HTTPステータスコードが含まれ、リクエストの結果を表します。

- **200 OK**: 正常に処理されたリクエスト
- **201 Created**: 新しいリソースが作成された
- **400 Bad Request**: 無効なリクエスト
- **401 Unauthorized**: 認証が必要
- **404 Not Found**: リソースが見つからない
- **500 Internal Server Error**: サーバーエラー

## 例

### GET /users

全ユーザーを取得します。

#### リクエスト

GET /users HTTP/1.1
Host: example.com

#### レスポンス

```json
[
  {
    "id": 1,
    "name": "John Doe",
    "email": "john.doe@example.com"
  },
  {
    "id": 2,
    "name": "Jane Smith",
    "email": "jane.smith@example.com"
  }
]
```

# RestApiの概念

### 副作用

データが変更されること

### 安全性

副作用がないこと<br>
データが変更されないこと、読み取り専用のこと

- get

### 冪等性

副作用の有無を問わない
何度実行しても同じ状態

- get
- put
- delete

## Restとは

分散型システムにおける設計原則群

要は **_設計ルール_**

### クライアント/サーバ

クライアントはトリガーで
サバーは受け身（今はpushもある）

### ステートレス

### キャッシュ制御

### 統一インターフェイス

### 階層化システム

3層アーキテクチャなど
多層アーキテクチャ

カプセル化をして独立できる
データ処理でオーバヘッドが懸念点

### コードオンデマンド

リリース後にクライアントコードを変更できる

メリット<br>
リリース済みのクライアントに対し機能追加できる

デメリット<br>
評価環境が複雑になる

## REST API 成熟モデル

4段階

### LEVEL0

httpの使用（xml形式）

単なる通信手段で1URLですべてが完結している

### LEVEL1

リソースごとにURLを分割している

例としてはgetやpostのみ

### LEVEL2

httpの動詞の導入でcrud操作格納

get/post/patch/delete

### LEVEL3

HATEOASの概念の導入<BR>
レスポンスに現在の状態に関連する内容を管理<BR>
昔のシステムならURL内にページリンクなどがある<BR>
json 内のurlの情報等

## URI設計

### 短く入力しやすいこと

シンプルで覚えやすいものにする

### 人が読んで理解できる

省略文字を使用しない、他人や文PJ等が変わっても理解できること

### 大文字込み児が混在しない

すべて小文字で統一することで小文字

### 単語はハイフンでつなぐ

ハイフンは単語をつなぐため<br>
URIを見直すこともあり

### 単語は複数形で

URIで表現しているのは「リソースの集合」

### エンコードを必要とする文字を使用しない

URIから意味が理解できない文字を使用しない

### サーバー側のアーキテクチャを反映しない

わかりにくいし、改修しにくい

### ルールの統一化

クエリパラメータやパスパラメータの統一感があるか

### クエリパラメータ

省略可能

### パスパラメータ

一意なリソースを表す

## 大量アクセス制御

### レートリミット

API可に伴い、大量アクセスが発生する<br>
対策として、時間あたりのアクセス制限をかける
その対策がレートリミットである

### レートリミットの設計時の考慮点

誰に対して？

- APIキー
  ユーザID

何に対して？

- 単一機能？
- API全体？

制限回数

- 10回
- 100回

単位時間

- 10分
- 1時間
- 1日

## レートリミットのアルゴリズム

### Fixd Window

30回10分の場合

10分刻みにリセット

メリット　わかりやすい

デメリット　最初にアクセスが有るとその後は制御がかかる

### Silding log

30回10分の場合

過去10分間のログの回数

メリット　わかりやすい

デメリット　過去ログを大量に保存する必要がある

### Sliding window

上記２つの組み合わせのようなもの

柔軟だが計算式の理解が必要

## API脆弱性対策

### XSS

スクリプトを埋め込み、情報の操作や取得が行われる

対策

レスポンスヘッダーの追加等

### SCRF

クロスサイトリクエスト

本来拒否しないと行けないアクセス元のリクエストを処理していしまう

対策

- 許可しないアクセス元のリクエストを拒否
- 推測されにくいトークンの発行

### HTTP

通信が暗号化されていないので盗聴しやすい

対策

- SSL:廃止されている
- TLS:SSLの光景
- HTTPS:HTTP+SSL/TLS

HTTPS

webで安全に通信するプロトコル

### JSON WEB TOKEN

クライアント側で内容の編集が簡単にできる

なので、改ざんされたデータを適切なものと勘違いする

対策

ヘッダーのalgに”none”以外を指定して署名を暗号化する

# API

## OPEN APIとは

今まで慣れ親しんだJsonやYAMLで値が取得できる

### OPEN API Specification

書式ルール

### swagger

OPEN APIを作成するツール群

- swagger editor
- swagger codegen
- swagger ui
