# BFF（Backend for Frontend）とState管理原則

## BFF（Backend for Frontend）

### 1. 概念

BFFは特定のフロントエンドに最適化されたバックエンドです。

通常のREST APIは「汎用的」ですが、フロント画面からすると欲しい形でデータが取れないことが多いです。

**例：**

- 画面では「ユーザー基本情報」と「権限一覧」を一緒に表示したい
- でもAPIが分かれていて `GET /users/1` と `GET /roles` を別々に呼ぶ必要がある
- → 通信回数が増えて遅くなる

そこで「画面に必要な形」でデータをまとめて返す専用APIを用意するのがBFFです。

### 2. 実装イメージ

```http
GET /bff/userEditInitialData
```

```json
{
  "user": { "id": 1, "name": "山本" },
  "roles": [
    { "value": "admin", "label": "管理者" },
    { "value": "user", "label": "一般ユーザー" }
  ]
}
```

フロントはこれ一発で必要データを全部取れます。

### 3. ポイント

- RESTの純粋性（リソース指向）からは少し外れる
- でもパフォーマンス最適化・開発効率アップのために現場ではよく使う
- 特にSPA + 業務システムでは定番パターン

---

## State管理原則

SPAは「状態管理」が難しいです。ここでいうstate（状態）は大きく2種類あります。

### 1. UI state（表示状態）

- モーダル開いてる？閉じてる？
- 今のタブはどれ？
- チェックボックスは選択済み？

`フロント側だけで持つべき状態。サーバーには関係ない。`

### 2. Server state（サーバーから取得した業務データ）

- ユーザー一覧
- ドロップダウンのマスターデータ
- 詳細画面のユーザー情報

  `サーバーと同期が必要。`

例：ユーザーを編集したら、サーバーにも保存して一覧を更新する。

### 3. 原則（よく言われるルール）

- **UI state と Server state を混ぜない**
- **UI状態は Jotai/Recoil/Redux などに閉じ込める**
- **Server state は React Query/SWR で管理する**（キャッシュ・再取得・同期を自動でやってくれる）
- **一意キー（id）でサーバーデータを管理する**

`複合キーのままだとUI更新が面倒なので、idを返す（前回の話につながる）`

---

## まとめ

- **BFF** → 「画面単位で最適化されたAPI」。通信を減らして開発を楽にする。
- **state管理原則** → 「UI状態」と「サーバー状態」を分けて考える。ReactQueryやJotaiなど役割を分担する。
